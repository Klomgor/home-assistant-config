## TEMPLATES / OFFICE

# --- sensors ---
- sensor:
  # -- xiaomi aqara --
  # temperature
  - name: 'Office Temperature 1 Decimal'
    device_class: temperature
    unit_of_measurement: 'Â°C'
    state: >
      {% if is_number(state_attr('sensor.snr_officeclimate_temperature', 'temperature')) %}
        {{ state_attr('sensor.snr_officeclimate_temperature', 'temperature') | round(1, default=20.0) }}
        {% else %}
          {# use previous value if sensor returns unknown #}
          {{ states('sensor.office_temperature_1_decimal') }}
        {% endif %}

  # -- xiaomi mi flora --
  # soil soil moisture
  - name: 'Plnt Dracaena Trifasciata Soil'
    state: >
      {% if state_attr('plant.office_dracaena_trifasciata', 'problem') | regex_search('moisture low', ignorecase=True) %}
        {# report the moisture unit difference - #}
        {% if is_number(state_attr('plant.office_dracaena_trifasciata', 'moisture') | int) %}
          {% set offset = "%-g" | format(((state_attr('plant.office_dracaena_trifasciata', 'moisture') - 5 | int))) %}
          Soil Moisture Low ({{ offset }})
        {% else %}
          Soil Moisture Low
        {% endif %}
      {% elif state_attr('plant.office_dracaena_trifasciata', 'problem') | regex_search('moisture high', ignorecase=True) %}
        {# report the moisture unit difference + #}
        {% if is_number(state_attr('plant.office_dracaena_trifasciata', 'moisture') | int) %}
          {% set offset = "%+g" | format(((state_attr('plant.office_dracaena_trifasciata', 'moisture') | int) - 50)) %}
          Soil Moisture High ({{ offset }})
        {% else %}
          Soil Moisture High
        {% endif %}
      {% else %}
        Normal
      {% endif %}
