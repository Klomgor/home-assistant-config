## SENSORS / TEMPLATES / FAMILY ROOM

# -- xiaomi mi --
# temperature
- name: 'FamilyRoom Temperature 1 Decimal'
  device_class: temperature
  unit_of_measurement: 'Â°C'
  # return last value if we get 'unknown' state attribute from device. this
  # happens for zigbee devices after home assistant restart.
  state: >
    {% if is_number(states('sensor.snr_familyroom_climatedisplay_temperature')) %}
      {{ states('sensor.snr_familyroom_climatedisplay_temperature') | round(1, default=20.0) }}
    {% else %}
      {# use previous value if sensor returns unknown #}
      {{ states('sensor.familyroom_temperature_1_decimal') }}
    {% endif %}

# -- xiaomi mi flora --
# plant soil moisture
- name: 'Plnt Parlor Palm Soil'
  unique_id: plnt_parlor_palm_soil
  state: >
    {% if state_attr('plant.familyroom_parlor_palm', 'problem') | regex_search('moisture low', ignorecase=True) %}
      {# report the moisture unit difference - #}
      {% if is_number(state_attr('plant.familyroom_parlor_palm', 'moisture') | int) %}
        {% set offset = "%-g" | format(((state_attr('plant.familyroom_parlor_palm', 'moisture') - 15 | int))) %}
        Soil Moisture Low ({{ offset }})
      {% else %}
        Soil Moisture Low
      {% endif %}
    {% elif state_attr('plant.familyroom_parlor_palm', 'problem') | regex_search('moisture high', ignorecase=True) %}
      {# report the moisture unit difference + #}
      {% if is_number(state_attr('plant.familyroom_parlor_palm', 'moisture') | int) %}
        {% set offset = "%+g" | format(((state_attr('plant.familyroom_parlor_palm', 'moisture') | int) - 60)) %}
        Soil Moisture High ({{ offset }})
      {% else %}
        Soil Moisture High
      {% endif %}
    {% else %}
      Normal
    {% endif %}
