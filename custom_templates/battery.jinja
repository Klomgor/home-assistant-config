{% macro is_battery_low(entity_id) %}
  {# battery_ok: 1=normal, 0=low #}
  {% if is_number(state_attr(entity_id, 'battery_ok')) %}
    {% if is_state_attr(entity_id, 'battery_ok', 0) %}
      {{ true }}
    {% else %}
      {{ false }}
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro persist_value(entity_id, persist_entity_id) %}
  {% if is_number(states('sensor.toothbrush_anne_battery')) %}
    {{ states(entity_id) }}
  {% else %}
    {# use previous value if sensor returns unavailable #}
    {{ states(persist_entity_id) }}
  {% endif %}
{% endmacro %}
